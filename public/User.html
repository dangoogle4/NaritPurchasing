<!DOCTYPE html>
<html>
<style>
body {
	 background-color: #91ced4;
}
 body * {
	 box-sizing: border-box;
}
 .header {
	 background-color: #327a81;
	 color: white;
	 font-size: 1.5em;
	 padding: 1rem;
	 text-align: center;
	 text-transform: uppercase;
}
 /* img {
	 border-radius: 50%;
	 height: 60px;
	 width: 60px;
} */
 .table-users {
	 border: 1px solid #327a81;
	 border-radius: 10px;
	 box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.1);
	 max-width: calc(100% - 2em);
	 margin: 1em auto;
	 overflow: hidden;
	 width: 800px;
}
 table {
	 width: 100%;
}
 table td, table th {
	 color: #000000;
	 padding: 10px;
}
 table td {
	 text-align: center;
	 vertical-align: middle;
}
 table td:last-child {
	 font-size: 0.95em;
	 line-height: 1.4;
	 text-align: left;
}
 table th {
	 background-color: #ffffff;
	 font-weight: 300;
}

 table tr:nth-child(n) {
	 background-color: white;
}
 table tr:nth-child(2n+1) {
	 background-color: #edf7f8;
}
 @media screen and (max-width: 700px) {
	 table, tr, td {
		 display: block;
	}
	 td:first-child {
		 position: absolute;
		 top: 50%;
		 transform: translateY(-50%);
		 width: 100px;
	}
	 td:not(:first-child) {
		 clear: both;
		 margin-left: 100px;
		 padding: 4px 20px 4px 90px;
		 position: relative;
		 text-align: left;
	}
	 td:not(:first-child):before {
		 color: #91ced4;
		 content: '';
		 display: block;
		 left: 0;
		 position: absolute;
	}
	 td:nth-child(2):before {
		 content: 'Name:';
	}
	 td:nth-child(3):before {
		 content: 'Email:';
	}
	 td:nth-child(4):before {
		 content: 'Phone:';
	}
	 td:nth-child(5):before {
		 content: 'Comments:';
	}
	 tr {
		 padding: 10px 0;
		 position: relative;
	}
	 tr:first-child {
		 display: none;
	}
}
 @media screen and (max-width: 500px) {
	 .header {
		 background-color: transparent;
		 color: #fff;
		 font-size: 2em;
		 font-weight: 700;
		 padding: 0;
		 text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.1);
	}
	 img {
		 border: 3px solid;
		 border-color: #daeff1;
		 height: 100px;
		 margin: 0.5rem 0;
		 width: 100px;
	}
	 td:first-child {
		 background-color: #c8e7ea;
		 border-bottom: 1px solid #91ced4;
		 border-radius: 10px 10px 0 0;
		 position: relative;
		 top: 0;
		 transform: translateY(0);
		 width: 100%;
	}
	 td:not(:first-child) {
		 margin: 0;
		 padding: 5px 1em;
		 width: 100%;
	}
	 td:not(:first-child):before {
		 font-size: 0.8em;
		 padding-top: 0.3em;
		 position: relative;
	}
	 td:last-child {
		 padding-bottom: 1rem !important;
	}
	 tr {
		 background-color: white !important;
		 border: 1px solid #6cbec6;
		 border-radius: 10px;
		 box-shadow: 10px 10px 0 rgba(0, 0, 0, 0.1);
		 margin: 0.5rem 0;
		 padding: 0;
	}
	 .table-users {
		 border: none;
		 box-shadow: none;
		 overflow: visible;
	}
  
}
table td, table th  {
    border: 0.5px solid powderblue;
}
  
.dropbtn {
  background-color: #ffffff;
  color: rgb(73, 69, 69);
  padding: 16px;
  font-size: 16px;
  border: none;
  cursor: pointer;
}

.dropdown {
  position: relative;
  display: inline-block;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f9f9f9;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}

.dropdown-content a:hover {background-color: #f1f1f1}

.dropdown:hover .dropdown-content {
  display: block;
}

.dropdown:hover .dropbtn {
  background-color: #ffffff;
}


 
</style>

<body onload="showData()"   >
  <meta charset="utf-8" >
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <nav class="navbar navbar-default">
    <div class="container-fluid" style="background-color: rgb(255, 255, 255);">
      <div class="navbar-header">
        <a class="navbar-brand" href="/main">X</a>
        
      </div>
      <!-- <ul class="nav navbar-nav">
        <li ><a href="/main">Home</a></li>
        <li><a href="/user">user</a></li>
        <li><a href="/admin">admin</a></li>
        <li><a href="/">Page 3</a></li>
      </ul> -->
      <ul class="nav navbar-nav navbar-right">
        <li>
          <div class="dropdown">
             <button class="dropbtn">Setting
             <i class="fa fa-caret-down"></i>
             </button>
             <div class="dropdown-content">
             <a href="/useredit">ดูข้อมูลสมาชิก</a>
             <a href="/shopedit">ดูข้อมูลร้านค้า</a>
             <!-- <a href="#">Link 3</a> -->
             </div>
           </div>
           </li>
        <li><a href="/"><span class="glyphicon glyphicon-log-in"></span> Logout</a></li>
        </ul>
    </div>
  </nav>
  <div id="Home" class="tabcontent">
    <!-- <h3>Home</h3> -->
    <div style="margin: 150px;">
        <form style="text-align:  center; margin: 40px;"">
          <!-- <form style="text-align:  center; "> -->
          
          <label > รหัสการจัดชื้อ </label>&nbsp;&nbsp;<input readonly id="codeForBuy" type="text" >
             
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          <label> ชื่องบประมาณ </label>&nbsp;&nbsp; <input  readonly id="nameproject" type="text">
            
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          <label>ราคารวมทั้งหมดของทุกชิ้น </label> &nbsp;&nbsp;<input readonly id="amountAll" type="text">
          <!-- ค้นหาที่นี่
          <input id="myInput" type="text" placeholder="ค้นหาที่นี่">
          <table id="myTable" cellspacing="0"> -->
    
          <!--<button >ค้นหา</button>-->
        </form>
        <br>
        <br>
    
        <!-- <div class="header">Users</div> -->
        <table id ="myInput"cellspacing="0" style="margin-top: 5px">
           <tr>
              <th>ลำดับ </th>
              <th>ชื่อวัสดุ</th>
              <th>Part Number</th>
              <th>ราคา</th>
              <th>จำนวน</th>
              <th>ราคารวม</th>
              <th>ผู้รับผิดชอบ</th>
              <th>รูป</th>
              <!-- <th>รูป</th> -->
              <th>สถานะ</th>
              <!-- <th>ร้านค้า</th> -->
              <th>แก้ไข</th> 
              <th>ลบ</th>
              <tbody id="room-name"></tbody>
           </tr>
     
          

          
        </table>
     </div>

     <!-- <div>
      <form>
        รหัสการชื้อ 
        <input name="first" type="text">
           
        ชื่องบประมาณ
        <input  name="last" type="text">
          
        ราคารวมทั้งหมดของทุกชิ้น
        <input  name="lastmak" type="text">
        ค้นหาที่นี่
        <input id="myInput" type="text" placeholder="ค้นหาที่นี่">
        <table id="myTable" cellspacing="0">
  
        <<button >ค้นหา</button>-->
      <!-- </form>
      <br>
  
  
       <div class="header">Shop</div> -->
      
         <!-- <tr>
            <th>ลำดับ </th>
            <th>ชื่อวัสดุ</th>
            <th>Part Number</th>
            
            <tbody id="room-namezz"></tbody>
         </tr> -->
   
        

<!--         
      </table>
   </div>  -->
     <button style="float: right; margin: 20px;" type="button" class="btn btn-light" data-toggle="modal" data-target="#myModal">เพิ่มข้อมูล</button>
     <button style="float: right; margin: 20px;" type="button"  class="btn btn-light" data-toggle="modal" data-target="#ModalForAddShop">เพิ่มร้านค้า</button>
     <!-- <button  style="float: right; margin: 10px;" onclick='showshop()'>DATAALL</button> -->
      <!-- Modal -->
      <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">
        
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">เพิ่มข้อมูล</h4>
            </div>
            <div class="modal-body">
              <form id="imageuploadkub"method="post" action="/uploaduser" enctype="multipart/form-data" >
                <!-- <label>ร้านค้าของท่าน</label><select style="margin-left: 0.5em; width:170px; height: 25px;" class="custom-select storage" style="width:150px; height: 25px;" id="storage" required></select> -->
              
              <br>
                <label>ชื่อวัสดุ</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input  id="item" name="item" type="text"><br>
                <br>
                <label>Part Number</label>
                <input id="partnumber" name="partnumber" type="text"><br>  
                <br>
                <label>ราคา</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input  id="price" name="price" type="number"><br>
                <br>
                <label>จำนวน</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input  id="amountz" name="amount" type="number"><br>
                <br>
                <label>ราคารวม</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input  id="sumprice" name="sumprice" type="text"><br>
                <br>
                <label>ผู้รับผิดชอบ</label>&nbsp;&nbsp;&nbsp;&nbsp;<input  id="responsibleperson" name="responsibleperson" type="text"><br>
                <br>
                <label >สถานะ</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input  id="statusz" type="text"><br>
                <br>
                <div class="form-group">
                  <label for="img">รูป:</label>

                  <div class="form-group">
                    <label for="firstname">Upload</label>
                    <input type="file" class="form-control" name="fileuploadUser" id="image">
                  </div>
                  <!-- <button type="submit" class="btn btn-primary">Submit</button> -->
                  <button type="reset" class="btn btn-primary">Reset</button>
                  <!-- <input type="file" id="img" name="img" accept="image/*"> -->
                  <!-- <input type="file" name="multi-files"  id="image" class="form-control-file border"/>
                  <input type="button" value="Resize Image"  onclick="ResizeImage()"/> 
                  <button type="button" class="btn btn-light" data-toggle="modal"  onclick="Main()">อัพโหลด</button> -->
                  <!-- <div class="preview-images"></div> -->
                  <!-- <button type="button" class="btn btn-light" data-toggle="modal"  onclick="Main()">อัพโหลด</button> -->
                  <br>
                  <br>
                  <!-- <input name="imagefile[]" type="file" id="takePictureField" accept="image/*" onchange="uploadPhotos(base66)" />
                  <form id="uploadImageForm" enctype="multipart/form-data">
                      <input id="name" value="#{name}" />
                      ... a few more inputs ... 
                  </form> -->

                  <!-- <input id="imageFile" name="imageFile" type="file" class="imageFile"  accept="image/*"   />  -->
                  <!-- <input id="imageFilenew" name="imageFilenew" type="file" class="imageFilenew"  accept="image/*"   />  -->
                  <!-- <input type="button" value="Resize Image"   onclick="ResizeImage()"/>  -->
                  <!-- <button type="button" class="btn btn-light" onclick="Main()">อัพโหลด</button> -->

                  <br/>
                  <!-- <img src="" id="preview">
                  <img src="" id="output"> -->
              </div>
                <br>
                <button class="btn btn-light" type="submit" data-toggle="modal" data-target="#myModal" onclick="addData()">เพิ่มข้อมูล</button>
                <input  class="btn btn-light" type="reset" value="ล้าง">
                </form>    
            </div>
            <!-- <div class="modal-footer">
              
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div> -->
          </div>
          
        </div>
      </div>


      <script>


        const fileInput = document.getElementById("imageFile");
        
        
    
        window.addEventListener('paste', e => {
          fileInput.files = e.clipboardData.files;
        });

        // const fileInput2 = document.getElementById("imageFilenew");

        
       

      var filekub = "";
      var filekub2 = "";


      function ResizeImagenew() {
        console.log("DDDDD")
        for(let i =0 ; i <2;i++){
          if (window.File && window.FileReader && window.FileList && window.Blob) {
          var filesToUploads = document.getElementById('imageFilenew').files;
          console.log("filesToUploads"+filesToUploads)
          var file = filesToUploads[0];
          if (file) {

              var reader = new FileReader();
              // Set the image once loaded into file reader
              reader.onload = function(e) {

                  var img = document.createElement("img");
                  img.src = e.target.result;

                  var canvas = document.createElement("canvas");
                  var ctx = canvas.getContext("2d");
                  ctx.drawImage(img, 0, 0);

                  var MAX_WIDTH = 200;
                  var MAX_HEIGHT = 200;
                  var width = img.width;
                  var height = img.height;

                  if (width > height) {
                      if (width > MAX_WIDTH) {
                          height *= MAX_WIDTH / width;
                          width = MAX_WIDTH;
                      }
                  } else {
                      if (height > MAX_HEIGHT) {
                          width *= MAX_HEIGHT / height;
                          height = MAX_HEIGHT;
                      }
                  }
                  canvas.width = width;
                  canvas.height = height;
                  var ctx = canvas.getContext("2d");
                  ctx.drawImage(img, 0, 0, width, height);

                  dataurl = canvas.toDataURL(file.type);
                  document.getElementById('output').src = dataurl;
                  filekub2 = dataurl;
                  console.log("[qw[pq[pwp=-=-=-=-"+filekub2);
              }
              console.log("MAMA");
              reader.readAsDataURL(file);
              console.log("file---->>"+canvas.toDataURL(file.type));
              //filekub = canvas.toDataURL(file.type);
              //console.log("[qw[pq[pwp"+filekub);
    }

} else {
    alert('The File APIs are not fully supported in this browser.');
}
   }

}



      function ResizeImage() {
      for(let i =0 ; i <2;i++){
        if (window.File && window.FileReader && window.FileList && window.Blob) {
        var filesToUploads = document.getElementById('imageFile').files;
        var file = filesToUploads[0];
        if (file) {

        var reader = new FileReader();
        // Set the image once loaded into file reader
        reader.onload = function(e) {

            var img = document.createElement("img");
            img.src = e.target.result;

            var canvas = document.createElement("canvas");
            var ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0);

            var MAX_WIDTH = 200;
            var MAX_HEIGHT = 200;
            var width = img.width;
            var height = img.height;

            if (width > height) {
                if (width > MAX_WIDTH) {
                    height *= MAX_WIDTH / width;
                    width = MAX_WIDTH;
                }
            } else {
                if (height > MAX_HEIGHT) {
                    width *= MAX_HEIGHT / height;
                    height = MAX_HEIGHT;
                }
            }
            canvas.width = width;
            canvas.height = height;
            var ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, width, height);

            dataurl = canvas.toDataURL(file.type);
            document.getElementById('output').src = dataurl;
            filekub = dataurl;
            console.log("[qw[pq[pwp"+filekub);
        }
        console.log("MAMA");
        reader.readAsDataURL(file);
        console.log("file---->>"+canvas.toDataURL(file.type));
        //filekub = canvas.toDataURL(file.type);
        //console.log("[qw[pq[pwp"+filekub);
    }

} else {
    alert('The File APIs are not fully supported in this browser.');
}
   }

}



var base66 = "";
    const toBase64 = file => new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = () => resolve(reader.result);
    reader.onerror = error => reject(error);
});

async function Main() {
   const file = document.querySelector('#imageFile').files[0];
   console.log(await toBase64(file));
   base66 = await toBase64(file);
   
  }

Main();



var canvas = document.createElement("canvas");
var ctx = canvas.getContext("2d");

canvas.width = 32; // target width
canvas.height = 32; // target height

var image = new Image();
document.getElementById("image").appendChild(image);

image.onload = function(e) {
    ctx.drawImage(image, 
        0, 0, image.width, image.height, 
        0, 0, canvas.width, canvas.height
    );
    // create a new base64 encoding
    var resampledImage = new Image();
    resampledImage.src = canvas.toDataURL();
    document.getElementById("imagenew").appendChild(resampledImage);
};


// $(document).ready(function() {
 
//  $('#imageFile').change(function(evt) {

//      var files = evt.target.files;
//      var file = files[0];

//      if (file) {
//          var reader = new FileReader();
//          reader.onload = function(e) {
//              document.getElementById('preview').src = e.target.result;
//          };
//          reader.readAsDataURL(file);
//      }
//  });
// });






$(".image").submit(function (m) {
                m.preventDefault();
                var formData = new FormData(this);
                // console.log(formData.get("sampleimage").name);
                console.log(formData.get("sampleimage").name);

                let name_image = formData.get("sampleimage").name;
                // console.log(window.location.pathname);

                $.ajax({
                  url: "/uploadImageTemporary",
                  type: "POST",
                  data: formData,
                  success: function (data) {
                    console.log(data);
                    //updateImage(name_image);
                    // console.log(file_data);
                    imageUpload();
                  },
                  cache: false,
                  contentType: false,
                  processData: false,
                });
              });

              function updateImage(name_image) {
                $.post(
                  "/getPicBySerialNumber",
                  { serialnumber: serial_local },
                  function (dataOutput, status) {
                    var fileData = [];
                    for (let i = 0; i < dataOutput.files.length; i++) {
                      // add all files name to array
                      fileData.push(dataOutput.files[i]);
                    }
                    $.post(
                      "/update/image",
                      {
                        equipmentid: equipmentid,
                        uploadimage: JSON.stringify(fileData),
                      },
                      function (data, status) {
                        // console.log(data);

                        if (data.result.ok == 1) {
                          //window.location.reload();
                          editequipment();
                          // document.getElementById("exgallery").innerHTML = "";
                        }
                      }
                    );
                  }
                );
              }

              
    $(document).ready(function() {
      let imagesPreview = function(input, placeToInsertImagePreview) {
        if (input.files) {
          let filesAmount = input.files.length;
          for (i = 0; i < filesAmount; i++) {
            let reader = new FileReader();
            reader.onload = function(event) {
              $($.parseHTML("<img>"))
                .attr("src", event.target.result)
                .appendTo(placeToInsertImagePreview);
            };
            reader.readAsDataURL(input.files[i]);
          }
        }
      };
      $("#image").on("change", function() {
        imagesPreview(this, "div.preview-images");
      });
    });




      </script>

      <div id="shopNameTab"> <button style="margin-left: 40px;" type="button" class="btn btn-light" onclick="showAllData()">DataAll</button>&nbsp;</div>
      
      

      <div class="modal fade" id="ModalForAddShop" role="dialog">
        <div class="modal-dialog">
        
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">เพิ่มร้านค้า</h4>
            </div>
            <div class="modal-body">
              <form>
                <label>ร้านค้าของท่าน</label><select style="margin-left: 0.5em; width:170px; height: 25px;" class="custom-select storage" style="width:150px; height: 25px;" id="storage" required></select>
                <!-- <label>ชื่อร้านค้า</label><input style="margin-left:2em" name="nameshop" type="text" id="nameshop"><br> -->
                <br>
                <br>
              
                
                <!-- <label for="typeshop">ประเภทร้านค้า</label>
                <select style="width:185px; height: 25px;" name="typeshopp" id="typeshoppp">
                  <option value="ในประเทศ">ในประเทศ</option>
                  <option value="ต่างประเทศ">ต่างประเทศ</option>
                </select>
                <br>
                <br>
                <label>ภาษีร้านค้า</label>
                <input style="margin-left:1.5em" name="taxshop" type="float" id="taxshop"><br>  
                <br> -->
                <button class="btn btn-default" type="button"  data-toggle="modal" data-target="#ModalForAddShop" onclick="addShop()">บันทึก</button>
                <input  class="btn btn-default" type="reset" value="ล้าง">
                </form>    
            </div>
            <!-- <div class="modal-footer">
              
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div> -->
          </div>
          
        </div>
      </div>






  </div>
 
    
  
  
  
  

    
      <!-- Modal -->
      <div class="modal fade" id="" role="dialog">
        <div class="modal-dialog">
        
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">Modal Header</h4>
            </div>
            <div class="modal-body">
              <form>
                <label>ชื่อร้าน</label>
                <input name="first" type="text"><br>
                <br>
                <label>ชื่อวัสดุ</label>
                <input  name="last" type="text"><br>
                <br>
                <label>Part Number</label>
                <input name="first" type="text"><br>  
                <br>
                <label>ราคา</label>
                <input  name="last" type="text"><br>
                <br>
                <label>จำนวน</label>
                <input  name="last" type="text"><br>
                <br>
                <label>ราคารวม</label>
                <input  name="last" type="text"><br>
                <br>
                <label>ผู้รับผิดชอบ</label>
                <input  name="last" type="text"><br>
                <br>
                <label>สถานะ</label>
                <input  name="last" type="text"><br>
                <div class="form-group">
                    <label for="img">รูป:</label>
                    <input type="file" id="img" name="img" accept="image/*">
                </div>
                <br>
                <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">เพิ่มข้อมูล</button>
                <input class="btn btn-info btn-lg" type="reset" value="Reset">
                </form>    
            </div>
            <div class="modal-footer">
              
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div>
          
        </div>
      </div>
  </div>
 


  
     
    


  <!-- Modal for Edit-->
  <div class="modal fade" id="ModalForEditData" role="dialog" >
    <!-- <div class="modal fade" id="Modalzz" role="dialog" onload="profile()"> -->
      <div class="modal-dialog"  >
      
        <!-- Modal content-->
        <div class="modal-content" >
          <!-- <div class="modal-header" >
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Modal EDIT</h4>
          </div> -->
          <div class="modal-body"  id="Modal-b" >
        
            <form>
        <input class="btn btn-info btn-lg" type="reset" value="Reset">
        <!-- <div id="Modal-a"></div> -->
        
        
              </form>
              <!-- <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#Modalzz">Update</button> -->
          </div>
          <div class="modal-footer">
        <!-- <button  style="float: left;" type="button" class="btn btn-default" data-toggle="modal" data-target="#ModalForEditData" onclick="addEdit()">บันทึก</button> -->
            <button style="float: right;" type="button" class="btn btn-default" data-dismiss="modal">ล้าง</button>
          </div>
        </div>
        
      </div>
    </div>
    
  
  <div id="shopNameTab"></div>
  <!-- <button class="tablink" onclick="openPage('Home', this, 'red')" id="defaultOpen">ร้านแรก</button>
 <!<button class="tablink" onclick="showshop()" >ร้านสอง</button> -->
  <!-- <button class="tablink" onclick="openPage('News', this, 'green')" >ร้านสอง</button> 
  
  
  <button class="tablink" onclick="openPage('Contact', this, 'blue')" >ร้านสาม</button>
  <button class="tablink" onclick="openPage('About', this, 'orange')">ร้านสี่</button> --> 
  
  
  
  <script>

//var myCookie = getCookie("CookieUser");

var CookieUser = JSON.parse(getCookie("CookieUser"));

console.log("cookieร้อนๆครับโผม-->",  CookieUser.priority,
                                    CookieUser.name,
                                    CookieUser.surname,
                                    CookieUser.username,
                                    CookieUser.email);

// console.log("COOKIE RON RON KUB"+CookieUser);



console.log("มอยอ"+CookieUser)

function getCookie(name) {
 const value = `; ${document.cookie}`;
 const parts = value.split(`; ${name}=`);
 if (parts.length === 2) return parts.pop().split(";").shift();
}

function getCookie(cname) {
 var name = cname + "=";
 var decodedCookie = decodeURIComponent(document.cookie);
 var ca = decodedCookie.split(";");
 for (var i = 0; i < ca.length; i++) {
   var c = ca[i];
   while (c.charAt(0) == " ") {
     c = c.substring(1);
   }
   if (c.indexOf(name) == 0) {
     return c.substring(name.length, c.length);
   }
 }
 return "";
}



  function openPage(pageName,elmnt,color) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
      tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablink");
    for (i = 0; i < tablinks.length; i++) {
      tablinks[i].style.backgroundColor = "";
    }
    document.getElementById(pageName).style.display = "block";
    elmnt.style.backgroundColor = color;

    if (pageName) {

      //console.log("data");
    //   $.post("/get/shop", function (data, status) {
    //   console.log(data);
		//   //document.getElementById("room-namezz").innerHTML="";
    //   for (let i = 0; i < data.length; i++) {
		//   //console.log(data[i]._id);
		//   str = data[i]._id.replace(/\s/g, '');
		//   console.log(str);
    //     roomId = data;
		// // let rstripId = data[i]._id.rs
    //     //$("#room-name-value").val(data[0].room);
    //     $("#shopNameTab").append(
		//   "<tr><td>" +
    //         (i + 1) +
    //         "</td>" +
    //         "<td>"+
    //         "<button id='order"+i+"'>" + 
    //         data[i].nameOfShop +
    //   "</button>" +
    //   "</td>" +
		// 	"<td>" +
    //         data[i].typeOfShop +
		// 	"</td>" 
			
			

    //     );
    //   }
    // });
  

  }

  // function dropDataKrub(obj_id) {
	// let dropRoomId = obj_id.toString();
	// console.log(obj_id);
  //   $.post("/drop/DataKrup", { dropRoomId: dropRoomId }, function (data, status) {
  //     showData();
  //     console.log(obj_id);
	// });
  // }	

  function addEdit(){
			console.log('DDan');
    //var shopnew = $("#shopnew").val();
    var itemnew = $("#itemnew").val();
    var partnumbernew = $("#partnumbernew").val();
    var pricenew = $("#pricenew").val();
    var amountnew = $("#amountnew").val();
    var sumpricenew = $("#sumpricenew").val();
    var responsiblepersonnew = $("#responsiblepersonnew").val();
    var statusznew = $("#statusznew").val();
   //var statusnew = $("#statusnew").val();
    //var statusnew = $("#statusnew").val();


  console.log(shopnew,itemnew,partnumbernew);
  console.log(getDataId);

    $.post("/save/editdata",{  
							              'ServergetDataId':getDataId,	
							              //'shopnew':shopnew,
                            'itemnew':itemnew,
                            'partnumbernew':partnumbernew,
                            'pricenew':pricenew,
                            'amountnew':amountnew,
                            'sumpricenew':sumpricenew,	
							              'responsiblepersonnew':responsiblepersonnew,
                            'statusznew':statusznew,
                            //amountnew:amountnew,
                            // nameordernew:nameordernew,
                            // statusnew:statusnew,
                            // department: department
                            
                        },function(data, status){
							showData();
        });
    }
  }
  
  // Get the element with id="defaultOpen" and click on it
  document.getElementById("defaultOpen").click();
  </script>

<script>
  $(document).ready(function(){
    $("#myInput").on("keyup", function() {
      var value = $(this).val().toLowerCase();
      $("#myTable tr").filter(function() {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
      });
    });
  });


  
	function addData() {
		console.log("danxxx");
	  {
		if (confirm("ต้องการเพิ่มผู้ใช้หรือไม่")) {
      //var add = localStorage.getItem("shopIdForAdd");
      var codeForBuy = $("#codeForBuy").val();
      var item = $("#item").val();
		  var partnumber = $("#partnumber").val();
		  var price = $("#price").val();
      var amount = $("#amountz").val();
      var priceadmin =  "";
      var amountadmin =  "";
      var sumprice = $("#sumprice").val();
      var sumpriceadmin =  "";
      var responsibleperson = $("#responsibleperson").val();
      var statusz = $("#statusz").val();
      var storage = localStorage.getItem("shopIdForAdd");
      console.log("NAMEOFSHOP!!!---> "+codeForBuy,storage);
      var image =  $("#image").val().substring(12);
      console.log("FILEKUB"+ image);
		  //var group = $("#group").val();
		  //var department = $("#department").val();
  
		  $.post(
			"/api/adddata2",
			{
			  //shop: shop,
        item: item,
			  partnumber: partnumber,
        price: price,
        amount: amount,
        priceadmin: priceadmin,
        amountadmin: amountadmin,
        sumprice: sumprice,
        sumpriceadmin: sumpriceadmin,
        responsibleperson: responsibleperson,
        statusz: statusz,
        storage: storage,
        mainid: codeForBuy,
        picture: image,
        //picture: req.body.picture,
        //reason:  req.body.reason,
			  //group: status,
			  //department: department,
			},

			function (data, status) {
			  //window.location.href = "/user";
			  
			}
		  );
		 } 
	  } 
  }

  function addShop() {
		console.log("danxxx");
	  {
		if (confirm("ต้องการเพิ่มผู้ใช้หรือไม่")) {
		  var shop = $("#nameshop").val();
		  var type = $("#typeshoppp").val();
		  var tax = $("#taxshop").val();
      console.log(shop,type,tax);
		  //var group = $("#group").val();
		  //var department = $("#department").val();
      if(tax="7"){
        tax=1.07;
      }
		  $.post(
			"/api/addshop",
			{
			  shop: shop,
			  type: type,
			  tax: tax,
        //picture: req.body.picture,
        //reason:  req.body.reason,
			  //group: status,
			  //department: department,
			},

			function (data, status) {
        console.log(data);
			  window.location.href = "/user";
			  
			}
		  );
		 } 
	  } 
  }
  
  function showData() {

    console.log("amountAll"+getValueLocalStorage,getValueLocalStorageNameOrder,getValueLocalStorageAmount);

    $.post("/get/maintable", function (data, status) {
      console.log(data);
		//document.getElementById("room-name").innerHTML="";
      for (let i = 0; i < data.length; i++) {
		  //console.log(data[i]._id);
		  str = data[i]._id.replace(/\s/g, '');
		  console.log(str);
        roomId = data;
		// let rstripId = data[i]._id.rs
        //$("#room-name-value").val(data[0].room);
          $("#codeForBuy").val(getValueLocalStorage);
          $("#nameproject").val(getValueLocalStorageNameOrder);
          $("#amountAll").val(getValueLocalStorageAmount);
          //console.log("wpodkpoqwkdpqw"+getValueLocalStorageAmount);
        
      }   
    }); 


    $.post("/get/shopforadd", function (data, status) {
    
      let roomData = data;
      for (let i = 0; i < roomData.length; i++) {
        let roomName = roomData[i].nameOfShop;

        console.log("dadadadadadad--->>>>>???? "+roomData[i]._id)
        $(".storage").append(
          
            "<option value=" + roomData[i]._id + ">" + roomName + "</option>"
            

          
          
          
        );
        console.log("room----.>>>>>    "+roomName);
      }
              });
    
		 var sum = 0;
    $.post("/get/dataForSearchTableMainIdUser", {_ID: getValueLocalStorage},function (data, status) {
    document.getElementById("room-name").innerHTML="";
      
      console.log(data);
		//document.getElementById("room-name").innerHTML="";
      for (let i = 0; i < data.length; i++) {
        // data[i].sumprice =  data[i].price * data[i].amount;
        if( data[i].sumpriceadmin == null) {
        sum = sum + data[i].sumprice * ShowShopTax[data[i].shopid];
    }else {
      sum = sum + data[i].sumpriceadmin * ShowShopTax[data[i].shopid];
    }
        $("#amountAll").val(sum.toFixed(2));
        
        data[i].sumprice = data[i].price * data[i].amount * ShowShopTax[data[i].shopid];
		  //console.log(data[i]._id);
      str = data[i]._id.replace(/\s/g, '');
      strnew = data[i].picture.replace(/\s/g, '');
      stritem = data[i].item.replace(/\s/g, '');
		  console.log(str);
        roomId = data;
		// let rstripId = data[i]._id.rs
        //$("#room-name-value").val(data[0].room);
        $("#room-name").append(
		  "<tr><td>" +
            (i + 1) +
            "</td>" +    
			"<td>" +
            data[i].item +
			"</td>" +
			"<td>" +
            data[i].partnumber +
			"</td>" +
			"<td>" +
            data[i].price +
			"</td>" +
			"<td>" +
            data[i].amount +
      "</td>" +
      "<td>" +
            data[i].sumprice.toFixed(2) +
      "</td>" +
      "<td>" +
            data[i].responsibleperson +
      "</td>" +
      "<td>" +
        "<img width='200px' src='upload/temp/pic/"+data[i].picture+"' >" +
        // "<img  width='200px' src="+data[i].picture+" />" +
      "</td>" +
      "<td>" +
            data[i].statusz +
      "</td>" +
      // "<td>" +
      //         sum.toFixed(2) +
      // "</td>" +
      // "<td>" +
      //       ShowShopName[data[i].shopid] +
      // "</td>" +
			// "<td>" +
			// <a data-toggle="modal" data-target="#Modalzz">แก้ไข</a> +
			// "</td>" +
			 "<td><a data-toggle='modal' data-target='#ModalForEditData' class='btn btn-info'  onclick='editData("+i+")' >แก้ไข</a>" +
				//"<td><a data-toggle='modal' data-target='#Modalzz' data-target='#exampleModal02' onclick='save()' >แก้ไข</a>" +
            "<div class='modal fade' id='exampleModal02' tabindex='-1' role='dialog' aria-labelledby='exampleModal02Label' aria-hidden='true' data-backdrop='static' data-keyboard='false'>" +
            "<div class='modal-dialog modal-dialog-centered'>" +
            "<div class='modal-content'>" +
            "<div class='modal-header'>" +
            "<h5 class='modal-title'  id='exampleModal02Label'>แก้ไข</h5>" +
            "<button type='button' class='close' data-dismiss='modal' aria-label='Close'>" +
            "<span aria-hidden='true'>&times;</span>" +
            "</button>" +
            "</div>" +
            "<div class='modal-footer'>" +
            "<button type='button' class='btn btn-secondary' data-dismiss='modal'>ยกเลิก</button>" +
            "</div>" +
            "</div></td>" +
            "<td><button href='#' class='btn btn-danger' onclick=dropDataKrub('"+str.toString() + "_*&^_"+ strnew.toString() + "_*&^_" +  stritem.toString() +"') >ลบ</button></td>" +
			"</tr>"
			

        );
      }
    });
    $.post("/get/maintableforshopid",{_ID: getValueLocalStorage}, function (data, status) {

     // document.getElementById("room-namezz").innerHTML="";
      // $("#shopNameTab").append(
      //     "<a style='margin-left: 40px;'></a>"
      //   );
      for (let i = 0; i < data.length; i++) {
       for (let j = 0; j < data[i].shopid.length; j++) {
        console.log("3z"+data[i].shopid[j]);
        str = data[i]._id.replace(/\s/g, '');
		  console.log(str);
        roomId = data;
		// let rstripId = data[i]._id.rs
        //$("#room-name-value").val(data[0].room);
        $("#shopNameTab").append(
		  // "<tr><td>" +
      //       (i + 1) +
      //       "</td>" +
            //  "<td>"+ "<button class='tablink' onclick='"+openPage+"('"+data[i].nameOfShop+"'',"+this+", 'red')' id='order"+i+"'>" + data[i].nameOfShop +"</button>" + "</td>" 
            // "<td><button href='#' onclick=openPage('"+data[i].nameOfShop+"')  >name</button></td>" 
            // "<button></button>" 


            "<button class='btn btn-light' value='" + data[i].shopid[j] +"' id='forshop" + j + "' onclick='showshop("+ j +")'>" + ShowShopName[data[i].shopid[j]] +"</button>&nbsp;"
          
             
             
              // +"<input type='hidden' id='idshop"+i+"' value='" + data[i]._id +"'></input>"
            // ใช่ปะ ไรนะ ได้ ๆ  เยส      งานไม่ทำละเหรอพี่55555      
			
			


      
        );
       }
		  //console.log(data[i]._id);
		  
      }
      
    });
  }

  function openPage(pageName,elmnt,color) {
    console.log("openPage");
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablink");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].style.backgroundColor = "";
      }
      document.getElementById(pageName).style.display = "block";
      elmnt.style.backgroundColor = color;
    }

  function editData(i){
			console.log("addzzzz"+getDataId);
			$.post("/get/dataForSearchTableMainIdAdmin2",{_ID: getValueLocalStorage}, function (data, status) {
        
        //localStorage.setItem("itemforlogkub",itemNewForLog);
				console.log(data[i]._id);
        getDataId = data[i]._id;
        getdataPicture = data[i].picture;
        console.log("DATAID"+getDataId,getdataPicture);
        console.log(data);
				//console.log("add");
				document.getElementById("Modal-b").innerHTML="";
				$("#Modal-b").append(
          "<form method='post' action='/uploadNewUser' enctype='multipart/form-data' >"+
          "<label style='padding: left; margin: 10px'>ชื่อวัสดุ</label>"+"<input style='margin-left: 35px;' id='itemnew'type='text' type='text'value='"+ data[i].item +"'>" +'<br>'+ 
          '<br>'+
          "<label style='padding: left; margin: 10px'>Part Number</label>"+	"<input id='partnumbernew'type='text' type='text'value='"+ data[i].partnumber +"'>" +'<br>'+ 
          '<br>'+
          "<label style='padding: left; margin: 10px'>ราคา</label>"+"<input  style='margin-left: 49px;' id='pricenew'type='text' type='text'value='"+ data[i].price +"'>" +'<br>'+ 
          '<br>'+
          "<label style='padding: left; margin: 10px'>จำนวน</label>"+	"<input  style='margin-left: 41px;' id='amountnew'type='text' type='text'value='"+ data[i].amount +"'>" +'<br>'+ 
          '<br>'+
          "<label style='padding: left; margin: 10px'>ราคารวม</label>"+"<input  style='margin-left: 35px;' id='sumpricenew'type='text' type='text'value='"+ data[i].sumprice +"'>" +'<br>'+ 
          '<br>'+
          "<label style='padding: left; margin: 10px'>ผู้รับผิดชอบ</label>"+	"<input style='margin-left: 10px;' id='responsiblepersonnew'type='text' type='text'value='"+ data[i].responsibleperson +"'>" +'<br>'+ 
          '<br>'+
          // "<label style='padding: left; margin: 10px'>สถานะ</label>"+	"<input style='margin-left: 48px;' id='statusznew'type='text' type='text'value='"+ data[i].statusz +"'>" +'<br>'+ 
          // '<br>'+
          "<label style='padding: left; margin: 10px'>รูป</label>"+
          "<img  width='200px'  src='upload/temp/pic/"+data[i].picture+"' />" +
                "<div class='form-group'>"+
                  "<label for='firstname'>Upload</label>"+
                  "<input type='file' class='form-control' name='fileuploadNew' id='imagenew'>"+
                "</div>"+
           
          
          // "<input action='/uploadnew' type='file' class='form-control' name='fileuploadNew' id='imagenew'>"+
         
          // "<input type='button' value='Resize Image'   onclick='ResizeImagenew()'/>" 
          "<button type='submit' class='btn btn-primary' onclick='addEdit()'>update</button>"+
                
              "</form>"
          // "<input id='imageFilenew' name='imageFilenew' type='file' class='imageFilenew'  accept='image/*' /> "+
          // "<img  width='200px' src="+data[i].picture+" />" +
          // "<input type='button' value='Resize Image'   onclick='ResizeImagenew()'/>"

        );

        var itemNewForLog = document.getElementById(data[i].item);
        console.log("oq"+data[i].item);
        
        const fileInputEditkub = document.getElementById("imageFilenew");
        window.addEventListener('paste', e => {
          //editDataSoHard(editphoto);
          fileInputEditkub.files = e.clipboardData.files;
          
          
         
        });
    	
						
			});
    }

    //const fileInputEdit = 0;
   // var editphoto = 0;
    function editDataSoHard(i){
      //editphoto = 0;
      console.log("addzzsadsadsadaszz");
      var valueID = localStorage.getItem("shopIdForAdd");
      console.log("DIEDIEDIE"+ valueID);
      //editphoto = i;
      $.post("/get/dataForSearchTableMainIdAdmin23",{'_ID2': valueID ,_ID: getValueLocalStorage}, function (data, status) {
						
				console.log(data[i]._id);
        getDataId = data[i]._id;
        getdataPicture = data[i].picture;
        console.log("DATAID"+getDataId,getdataPicture);
        console.log(data);
				//console.log("add");
				document.getElementById("Modal-b").innerHTML="";
				$("#Modal-b").append(
          "<form method='post' action='/uploadNewUser' enctype='multipart/form-data' >"+
          "<label style='padding: left; margin: 10px'>ชื่อวัสดุ</label>"+"<input style='margin-left: 35px;' id='itemnew'type='text' type='text'value='"+ data[i].item +"'>" +'<br>'+ 
          '<br>'+
          "<label style='padding: left; margin: 10px'>Part Number</label>"+	"<input id='partnumbernew'type='text' type='text'value='"+ data[i].partnumber +"'>" +'<br>'+ 
          '<br>'+
          "<label style='padding: left; margin: 10px'>ราคา</label>"+"<input  style='margin-left: 49px;' id='pricenew'type='text' type='text'value='"+ data[i].price +"'>" +'<br>'+ 
          '<br>'+
          "<label style='padding: left; margin: 10px'>จำนวน</label>"+	"<input  style='margin-left: 41px;' id='amountnew'type='text' type='text'value='"+ data[i].amount +"'>" +'<br>'+ 
          '<br>'+
          "<label style='padding: left; margin: 10px'>ราคารวม</label>"+"<input  style='margin-left: 35px;' id='sumpricenew'type='text' type='text'value='"+ data[i].sumprice +"'>" +'<br>'+ 
          '<br>'+
          "<label style='padding: left; margin: 10px'>ผู้รับผิดชอบ</label>"+	"<input style='margin-left: 10px;' id='responsiblepersonnew'type='text' type='text'value='"+ data[i].responsibleperson +"'>" +'<br>'+ 
          '<br>'+
          // "<label style='padding: left; margin: 10px'>สถานะ</label>"+	"<input style='margin-left: 48px;' id='statusznew'type='text' type='text'value='"+ data[i].statusz +"'>" +'<br>'+ 
          // '<br>'+
          "<label style='padding: left; margin: 10px'>รูป</label>"+
          "<img  width='200px'  src='upload/temp/pic/"+data[i].picture+"' />" +
                "<div class='form-group'>"+
                  "<label for='firstname'>Upload</label>"+
                  "<input type='file' class='form-control' name='fileuploadNew' id='imagenew'>"+
                "</div>"+
           
          
          // "<input action='/uploadnew' type='file' class='form-control' name='fileuploadNew' id='imagenew'>"+
         
          // "<input type='button' value='Resize Image'   onclick='ResizeImagenew()'/>" 
          "<button type='submit' class='btn btn-primary' onclick='addEdit()'>update</button>"+
                
              "</form>"
          // "<input id='imageFilenew' name='imageFilenew' type='file' class='imageFilenew'  accept='image/*' /> "+
          // "<img  width='200px' src="+data[i].picture+" />" +
          // "<input type='button' value='Resize Image'   onclick='ResizeImagenew()'/>"

        );
        // location.reload();
        const fileInputEdit = document.getElementById("imageFilenew");
        window.addEventListener('paste', e => {
          //editDataSoHard(editphoto);
          fileInputEdit.files = e.clipboardData.files;
          
          
         
        });
						
      });
      
    }

    
        
        
    
        
    

    
    function showshop(valeshop) {

      console.log("DDDDDDDD---->>   "+ valeshop)
      //console.log("PEEGALE:"+ data[i].nameOfShop)
      var valueid = document.getElementById("forshop"+valeshop).value;
      var shopname = document.getElementById("forshop"+valeshop).innerHTML;

      console.log("มาแล้ว   -----"+ valueid,shopname) // ส่งไป >> ได้ ได้
      localStorage.setItem("ShopNameForAddData", shopname);
      localStorage.setItem("shopIdForAdd", valueid);

      

      $.post("/get/showshopnameintableinadminaccess",{ '_ID': valueid ,'_MAINID': getValueLocalStorage }, function (data, status) {
      document.getElementById("room-name").innerHTML="";
      for (let i = 0; i < data.length; i++) {
        data[i].sumprice = data[i].price * data[i].amount * ShowShopTax[data[i].shopid];
      str = data[i]._id.replace(/\s/g, '');
		  console.log(str);
        roomId = data;
		    // let rstripId = data[i]._id.rs
        //$("#room-name-value").val(data[0].room);
        $("#room-name").append(
		  "<tr><td>" +
            (i + 1) +
            "</td>" +
            "<td >" +
             data[i].item +
            "</td>" +
            "<td>" +
            data[i].partnumber +
            "</td>" +
            "<td>" +
            data[i].price +
			      "</td>" +
            "<td>" +
            data[i].amount +
            "</td>" +
            "<td>" +
            data[i].sumprice.toFixed(2) +
            "</td>" +
            "<td>" +
            data[i].responsibleperson +
            "</td>" +
            "<td>" +
              "<img width='200px' src='upload/temp/pic/"+data[i].picture+"' >" +
            "</td>" +
            "<td>"+
            data[i].statusz +
            "</td>" +
            "<td><a data-toggle='modal' data-target='#ModalForEditData' class='btn btn-info'  onclick='editDataSoHard("+i+")' >แก้ไข</a>" +
				//"<td><a data-toggle='modal' data-target='#Modalzz' data-target='#exampleModal02' onclick='save()' >แก้ไข</a>" +
            "<div class='modal fade' id='exampleModal02' tabindex='-1' role='dialog' aria-labelledby='exampleModal02Label' aria-hidden='true' data-backdrop='static' data-keyboard='false'>" +
            "<div class='modal-dialog modal-dialog-centered'>" +
            "<div class='modal-content'>" +
            "<div class='modal-header'>" +
            "<h5 class='modal-title'  id='exampleModal02Label'>แก้ไข</h5>" +
            "<button type='button' class='close' data-dismiss='modal' aria-label='Close'>" +
            "<span aria-hidden='true'>&times;</span>" +
            "</button>" +
            "</div>" +
            "<div class='modal-footer'>" +
            "<button type='button' class='btn btn-secondary' data-dismiss='modal'>ยกเลิก</button>" +
            "</div>" +
            "</div></td>" +
             "<td><button href='#' class='btn btn-danger' onclick=dropDataKrub('"+str.toString()+"') >ลบ</button></td>" +
      "</tr>"
      // "<td id='order"+i+"'>" +
      //         ShowShopName[data[i].shopid] +
      //         //  ShowShopName[data[i].shopid] +
      // "</td>" +

        );
        // document.getElementById("room-name").innerHTML="";
      }
      
    });
    
  }

  function dropDataKrub(obj_id) {

      var spiltkub = obj_id.split("_*&^_");
      console.log("MONEW"+obj_id.split("_*&^_"));
      //console.log("MOMNEWKUB   "+spiltkub[0]);
      console.log("MOMNEWKUB2   "+spiltkub[1]);
      let dropRoomId = spiltkub[0].toString();
      let itemkub = spiltkub[2].toString();
      console.log("newnewnew"+ itemkub);
      console.log("DDDDD"+dropRoomId);


      $.post("/drop/imageNewNew",{nameImageNew: spiltkub[1]},function(data,status){
      //   console.log("come");

          $.post("/drop/DataKrup", { dropRoomId: dropRoomId,'mainid': getValueLocalStorage,'itemkub': itemkub }, function (data, status) {
      
          //window.location.href = "/user";
          console.log(obj_id);
          });

       });

  

  }	

  var ShowShopName = {};
  var ShowShopTax = {};

  $(document).ready(function(){
      $.post('/get/shop', function(data, status)
      {
        ShopName = data;
          for(let i=0; i<ShopName.length; i++)
          {
              // console.log([data[i]]); 
              let objId = ShopName[i]._id;

              ShowShopName[objId] = ShopName[i].nameOfShop;
              ShowShopTax[objId]  = ShopName[i].tax;

              //let nameCategory = categoryName[i].equip_category;

          }
      });
  });


  


  function addEdit(){
      console.log('DDan');
      if (confirm("ต้องการแก้ไขรายการสินค้าใช่หรือไม่")) {
    var shopnew = $("#shopnew").val();
    var itemnew = $("#itemnew").val();
    var partnumbernew = $("#partnumbernew").val();
    var pricenew = $("#pricenew").val();
    var amountnew = $("#amountnew").val();
    var sumpricenew = $("#sumpricenew").val();
    var responsiblepersonnew = $("#responsiblepersonnew").val();
    var statusznew = $("#statusznew").val();
    var image = $("#imagenew").val().substring(12);
    var mainidnew = getValueLocalStorage;


    // if (filekub2 != ""){
    //   image = filekub2;
      
    // }else {
    //   image = getdataPicture;
    //   console.log("getdataPicture!"+getdataPicture,filekub2);
    // }
   //var statusnew = $("#statusnew").val();
    //var statusnew = $("#statusnew").val();


  console.log(image,codeForBuy);
  //console.log(getDataId);

    $.post("/save/editdata",{  
							              'ServergetDataId':getDataId,	
							              'shopnew':shopnew,
                            'itemnew':itemnew,
                            'partnumbernew':partnumbernew,
                            'pricenew':pricenew,
                            'amountnew':amountnew,
                            'sumpricenew':sumpricenew,	
							              'responsiblepersonnew':responsiblepersonnew,
                            'statusznew':statusznew,
                            'image':image,
                            'mainidnew': mainidnew,
                            //amountnew:amountnew,
                            // nameordernew:nameordernew,
                            // statusnew:statusnew,
                            // department: department
                            
                        },function(data, status){
                         // window.location.href = "/user";
							          //showData();
        });
        //location.reload();
  }
} 			

function myFunctionselect(){
  console.log("DDDDDDDD---->>   "+ val)
      //console.log("PEEGALE:"+ data[i].nameOfShop)
      var valueid = document.getElementById("forshop"+val).value;

      console.log("มาแล้ว   -----"+ valueid) // ส่งไป >> ได้ ได้

      

    $.post("/get/showshopnameintable",{ '_ID': valueid }, function (data, status) {
      document.getElementById("room-name").innerHTML="";
      for (let i = 0; i < data.length; i++) {
        data[i].sumprice = data[i].price * data[i].amount * ShowShopTax[data[i].shopid];
      str = data[i]._id.replace(/\s/g, '');
		  console.log(str);
        roomId = data;
		    // let rstripId = data[i]._id.rs
        //$("#room-name-value").val(data[0].room);
        $("#room-name").append(
		  "<tr><td>" +
            (i + 1) +
            "</td>" +
            "<td >" +
             data[i].item +
            "</td>" +
            "<td>" +
            data[i].partnumber +
            "</td>" +
            "<td>" +
            data[i].price +
			      "</td>" +
            "<td>" +
            data[i].amount +
            "</td>" +
            "<td>" +
            data[i].sumprice.toFixed(2) +
            "</td>" +
            "<td>" +
            data[i].responsibleperson +
            "</td>" +
            "<td>" +
              "<td>" +
            data[i].picture +
            "</td>" +
            data[i].statusz +
            "</td>" 
      // "<td id='order"+i+"'>" +
      //         ShowShopName[data[i].shopid] +
      //         //  ShowShopName[data[i].shopid] +
      // "</td>" +

        );
      }
      
    });
}

function showAllData() {

location.reload();

// $.post("/get/dataForSearchTableMainIdAdmin2" ,{_ID: getValueLocalStorage},function (data, status) {
//   //document.getElementById("room-namedata").innerHTML="";
//     //console.log('Daaawww'+getValueLocalStorage);
//     var sum = 0 ;
// 	//document.getElementById("room-name").innerHTML="";
//     for (let i = 0; i < data.length; i++) {
//      // data[i].sumpriceadmin = 0;
//      console.log("NEWNEWNEWNEWNEWNEWNEWN"+data.length);
//        //data[i].sumpriceadmin = data[i].priceadmin * data[i].amountadmin;
//       //  data[i].sumprice = data[i].price * data[i].amount;
//        //data[i].sumprice = "";
//       // data[i].sumpriceadmin = "";
//     //   sum += parseInt(data[i].sumpriceadmin);
     

//     //  console.log("Sum = "+ sum);   
// 	  //console.log(data[i]._id);
// 	  str = data[i]._id.replace(/\s/g, '');
// 	  console.log("newienqwpdjqwidjmqowidjqwdij --->>>>>>>>"+str);
//       roomId = data;
// 	// let rstripId = data[i]._id.rs
//       //$("#room-name-value").val(data[0].room);
//       $("#room-namedata").append(
// 	  "<tr><td>" +
//           (i + 1) +
//           "</td>" +
// 		"<td>" +
//           data[i].item +
// 		"</td>" +
// 		"<td>" +
//           data[i].partnumber +
// 		"</td>" +
// 		"<td>" +
//           data[i].price +
// 		"</td>" +
// 		"<td>" +
//           data[i].amount +
//     "</td>" +
//     "<td>" +
//           data[i].priceadmin +
// 		"</td>" +
// 		"<td>" +
//           data[i].amountadmin +
//     "</td>" +
//     "<td>" +
//           data[i].sumprice +
//     "</td>" +
//     "<td>" +
//           data[i].sumpriceadmin +
//     "</td>" +
//     "<td>" +
//           data[i].responsibleperson +
//     "</td>" +
//     "<td>" +
//           data[i].statusz +
//     "</td>" +
//     "<td>" +
//           ShowShopName[data[i].shopid] +
//     "</td>" +
//     "<td>" +
//           [data[i].mainid] +
//     "</td>" +
// 		// "<td>" +
// 		// <a data-toggle="modal" data-target="#Modalzz">แก้ไข</a> +
// 		// "</td>" +
// 		 "<td><a data-toggle='modal' data-target='#myModalForEditDataAdmin' class='btn btn-info'  onclick='editData('"+i+"')' >แก้ไข</a>" +
// 			//"<td><a data-toggle='modal' data-target='#Modalzz' data-target='#exampleModal02' onclick='save()' >แก้ไข</a>" +
//           "<div class='modal fade' id='exampleModal02' tabindex='-1' role='dialog' aria-labelledby='exampleModal02Label' aria-hidden='true' data-backdrop='static' data-keyboard='false'>" +
//           "<div class='modal-dialog modal-dialog-centered'>" +
//           "<div class='modal-content'>" +
//           "<div class='modal-header'>" +
//           "<h5 class='modal-title'  id='exampleModal02Label'>แก้ไข</h5>" +
//           "<button type='button' class='close' data-dismiss='modal' aria-label='Close'>" +
//           "<span aria-hidden='true'>&times;</span>" +
//           "</button>" +
//           "</div>" +
//           "<div class='modal-footer'>" +
//           "<button type='button' class='btn btn-secondary' data-dismiss='modal'>ยกเลิก</button>" +
//           "</div>" +
//           "</div></td>" +
//           "<td><button href='#' class='btn btn-danger' onclick=DeleteDataAdmin('"+str.toString()+"') >ลบ</button></td>" +
// 		"</tr>"
    

//       );  
//     }
    
//   }); 

}



                  var tablesToExcel = (function() {
                      var uri = 'data:application/vnd.ms-excel;base64,'
                      , tmplWorkbookXML = '<?xml version="1.0"?><?mso-application progid="Excel.Sheet"?><Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet">'
                        + '<DocumentProperties xmlns="urn:schemas-microsoft-com:office:office"><Author>Axel Richter</Author><Created>{created}</Created></DocumentProperties>'
                        + '<Styles>'
                        + '<Style ss:ID="Currency"><NumberFormat ss:Format="Currency"></NumberFormat></Style>'
                        + '<Style ss:ID="Date"><NumberFormat ss:Format="Medium Date"></NumberFormat></Style>'
                        + '</Styles>' 
                        + '{worksheets}</Workbook>'
                      , tmplWorksheetXML = '<Worksheet ss:Name="{nameWS}"><Table>{rows}</Table></Worksheet>'
                      , tmplCellXML = '<Cell{attributeStyleID}{attributeFormula}><Data ss:Type="{nameType}">{data}</Data></Cell>'
                      , base64 = function(s) { return window.btoa(unescape(encodeURIComponent(s))) }
                      , format = function(s, c) { return s.replace(/{(\w+)}/g, function(m, p) { return c[p]; }) }
                      return function(tables, wsnames, wbname, appname) {
                        var ctx = "";
                        var workbookXML = "";
                        var worksheetsXML = "";
                        var rowsXML = "";

                        for (var i = 0; i < tables.length; i++) {
                          if (!tables[i].nodeType) tables[i] = document.getElementById(tables[i]);
                          for (var j = 0; j < tables[i].rows.length; j++) {
                            rowsXML += '<Row>'
                            for (var k = 0; k < tables[i].rows[j].cells.length; k++) {
                              var dataType = tables[i].rows[j].cells[k].getAttribute("data-type");
                              var dataStyle = tables[i].rows[j].cells[k].getAttribute("data-style");
                              var dataValue = tables[i].rows[j].cells[k].getAttribute("data-value");
                              dataValue = (dataValue)?dataValue:tables[i].rows[j].cells[k].innerHTML;
                              var dataFormula = tables[i].rows[j].cells[k].getAttribute("data-formula");
                              dataFormula = (dataFormula)?dataFormula:(appname=='Calc' && dataType=='DateTime')?dataValue:null;
                              ctx = {  attributeStyleID: (dataStyle=='Currency' || dataStyle=='Date')?' ss:StyleID="'+dataStyle+'"':''
                                    , nameType: (dataType=='Number' || dataType=='DateTime' || dataType=='Boolean' || dataType=='Error')?dataType:'String'
                                    , data: (dataFormula)?'':dataValue
                                    , attributeFormula: (dataFormula)?' ss:Formula="'+dataFormula+'"':''
                                    };
                              rowsXML += format(tmplCellXML, ctx);
                            }
                            rowsXML += '</Row>'
                          }
                          ctx = {rows: rowsXML, nameWS: wsnames[i] || 'Sheet' + i};
                          worksheetsXML += format(tmplWorksheetXML, ctx);
                          rowsXML = "";
                        }

                        ctx = {created: (new Date()).getTime(), worksheets: worksheetsXML};
                        workbookXML = format(tmplWorkbookXML, ctx);

                  console.log(workbookXML);

                        var link = document.createElement("A");
                        link.href = uri + base64(workbookXML);
                        link.download = wbname || 'Workbook.xls';
                        link.target = '_blank';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                      }
                    })();
		
var getValueLocalStorage = localStorage.getItem('thisIsParameterName');
var getValueLocalStorageNameOrder = localStorage.getItem("thisIsParameterNameForNameOrder");
var getValueLocalStorageAmount = localStorage.getItem("thisIsParameterNameForAmount");
var getValueLocalStorageAmountAdminToMain = localStorage.getItem("thisIsParameterNameForAmountAdminToMainTable");
var add = localStorage.getItem("shopIdForAdd");

var getDataId = "";


      


  </script>
  

</body>
</html>